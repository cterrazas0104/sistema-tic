<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci贸n - SEDIF</title>
    <style>
        :root { --primary: #2c3e50; --accent: #00ad9f; --bg: #f4f7f6; --warning: #e67e22; --danger: #e74c3c; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 20px; margin: 0; }
        .container { max-width: 1100px; margin: 20px auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { color: var(--primary); border-bottom: 2px solid var(--accent); padding-bottom: 10px; margin-top: 0; text-align: center; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 15px; margin-top: 20px; }
        .btn { display: block; background: var(--primary); color: white; padding: 15px; border-radius: 12px; text-decoration: none; font-weight: bold; text-align: center; transition: 0.3s; font-size: 0.85em; border: none; }
        .btn-main { background: var(--warning); color: white; border: 2px solid #d35400; } 
        .btn-accent { background: var(--accent); }
        .btn-ecala { background: #8e44ad; } 
        .btn:hover { opacity: 0.9; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .section-title { grid-column: 1 / -1; margin-top: 30px; color: #7f8c8d; font-size: 0.85em; text-transform: uppercase; letter-spacing: 1px; font-weight: bold; border-left: 4px solid var(--accent); padding-left: 10px; }
        .monitor-container { margin-top: 30px; overflow-x: auto; background: #fff; border: 1px solid #eee; border-radius: 12px; padding: 15px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85em; }
        th { background: #f8f9fa; padding: 12px; text-align: left; color: #666; border-bottom: 2px solid #eee; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        .btn-re { background: var(--warning); color: white; padding: 6px 12px; border-radius: 6px; text-decoration: none; font-size: 0.75em; font-weight: bold; }
        .logout-container { margin-top: 50px; text-align: center; }
        .btn-logout { background: none; border: none; color: var(--danger); cursor: pointer; font-weight: bold; text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Panel de Control Administrador</h2>
        
        <div class="grid">
            <div class="section-title">Gesti贸n de Tickets y Operaci贸n</div>
            <a href="pendientes.html" class="btn btn-main"> Tickets Pendientes de Asignaci贸n</a>
            <a href="ibreves.html" class="btn btn-ecala"> Nueva Incidencia Express</a>
            <a href="https://docs.google.com/spreadsheets/d/1I1cTeHiKZ3y2AFmNpZoh1QLQQRX-mwv6PQlxpfXD-nA/edit?gid=0#gid=0" target="_blank" class="btn btn-accent"> Base de Datos Completa (Excel)</a>
            
            <div class="section-title">Monitoreo de Tickets Asignados (Reasignaci贸n)</div>
            <div class="monitor-container" style="grid-column: 1 / -1;">
                <table>
                    <thead>
                        <tr>
                            <th>Ticket</th>
                            <th>T茅cnico / Equipo Actual</th>
                            <th>Usuario</th>
                            <th>Acci贸n</th>
                        </tr>
                    </thead>
                    <tbody id="monitor-body">
                        <tr><td colspan="4" style="text-align:center; padding:20px;">Cargando tickets activos...</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="section-title">Historiales Individuales</div>
            <a href="historial.html?nombre=Mtr. Gabriel Terrazas" class="btn"> Gabriel Terrazas</a>
            <a href="historial.html?nombre=Lic. Miguel Chavez" class="btn"> Miguel Chavez</a>
            <a href="historial.html?nombre=Lic. Eduardo Perez" class="btn"> Eduardo Perez</a>
            <a href="historial.html?nombre=Lic. Martin Alejandro Reyes Bocanegra" class="btn"> Alejandro Reyes</a>
            <a href="historial.html?nombre=Fati" class="btn"> Fati</a>
            <a href="historial.html?nombre=Lic. Luis Carlos" class="btn"> Luis Carlos</a>

            <div class="section-title">Equipos: Gabriel, Miguel, Eduardo y Alejandro</div>
            <a href="historial.html?nombre=Mtr. Gabriel - Lic. Eduardo" class="btn"> Gabriel - Eduardo</a>
            <a href="historial.html?nombre=Mtr. Gabriel - Lic. Miguel" class="btn"> Gabriel - Miguel</a>
            <a href="historial.html?nombre=Lic. Miguel - Lic. Eduardo" class="btn"> Miguel - Eduardo</a>
            <a href="historial.html?nombre=Lic. Eduardo - Lic. Alejandro" class="btn"> Eduardo - Alejandro</a>
            <a href="historial.html?nombre=Lic. Miguel - Lic. Alejandro" class="btn"> Miguel - Alejandro</a>
            <a href="historial.html?nombre=Mtr. Gabriel - Lic. Alejandro" class="btn"> Gabriel - Alejandro</a>

            <div class="section-title">Nuevos Equipos con Luis Carlos</div>
            <a href="historial.html?nombre=Lic. Luis Carlos - Lic. Alejandro" class="btn"> Luis Carlos - Alejandro</a>
            <a href="historial.html?nombre=Lic. Luis Carlos - Lic. Eduardo" class="btn"> Luis Carlos - Eduardo</a>
            <a href="historial.html?nombre=Lic. Luis Carlos - Lic. Miguel" class="btn"> Luis Carlos - Miguel</a>
            <a href="historial.html?nombre=Lic. Luis Carlos - Mtr. Gabriel" class="btn"> Luis Carlos - Gabriel</a>
        </div>

        <div class="logout-container">
            <button onclick="logout()" class="btn-logout">Cerrar Sesi贸n de Administrador</button>
        </div>
    </div>

    <script>
        if(localStorage.getItem('adminSession') !== 'active') { window.location.href = "index.html"; }
        function logout() { if(confirm("驴Est谩s seguro?")) { localStorage.removeItem('adminSession'); window.location.href = "index.html"; } }

        const diccionarioTecnicos = {
            "1": "Mtr. Gabriel Terrazas", "2": "Lic. Miguel Chavez", "3": "Lic. Eduardo Perez",
            "4": "Lic. Martin Alejandro Reyes Bocanegra", "5": "Fati", "6": "Mtr. Gabriel - Lic. Eduardo",
            "7": "Mtr. Gabriel - Lic. Miguel", "8": "Lic. Miguel - Lic. Eduardo", "9": "Lic. Eduardo - Lic. Alejandro",
            "10": "Lic. Miguel - Lic. Alejandro", "11": "Mtr. Gabriel - Lic. Alejandro", "12": "Lic. Luis Carlos",
            "13": "Lic. Luis Carlos - Lic. Alejandro", "14": "Lic. Luis Carlos - Lic. Eduardo",
            "15": "Lic. Luis Carlos - Lic. Miguel", "16": "Lic. Luis Carlos - Mtr. Gabriel"
        };

       async function cargarMonitor() {
    const webhookURL = 'https://hook.us2.make.com/g2o6bagpnddob1127nhxqpwc7t6sdadx?nombre=MONITOR'; 
    try {
        const res = await fetch(webhookURL);
        const data = await res.json();
        const body = document.getElementById('monitor-body');
        body.innerHTML = "";

        // Verificamos que 'data' sea un arreglo y tenga contenido
        if (!data || !Array.isArray(data) || data.length === 0) {
            body.innerHTML = "<tr><td colspan='4' style='text-align:center; padding:20px;'>No hay tickets asignados recientemente.</td></tr>";
            return;
        }

        data.forEach(t => {
            // NORMALIZACIN: Forzamos la lectura de campos sin importar may煤sculas
            const tid = t.id || t.ID || 'S/N';
            const tuser = t.usuario || t.Usuario || 'N/A';
            const tprob = t.problema || t.Problema || '';
            const ttec_id = String(t.tecnico || t.Tecnico || '9');
            
            // Traducimos el ID al nombre real para la tabla
            const nombreParaTabla = diccionarioTecnicos[ttec_id] || ttec_id;

            body.innerHTML += `
                <tr>
                    <td><b>#${tid}</b></td>
                    <td><span style="color:#2c3e50; font-weight:bold;">${nombreParaTabla}</span></td>
                    <td>${tuser}</td>
                    <td>
                        <a href="reasignar.html?id=${tid}&nombreActual=${encodeURIComponent(ttec_id)}&user=${encodeURIComponent(tuser)}&prob=${encodeURIComponent(tprob)}" 
                           class="btn-re">REASIGNAR</a>
                    </td>
                </tr>`;
        });
    } catch (e) { 
        console.error("Error cargando monitor:", e);
        document.getElementById('monitor-body').innerHTML = "<tr><td colspan='4' style='text-align:center; color:red;'>Error de comunicaci贸n con Make.</td></tr>"; 
    }
}
        
        cargarMonitor();
    </script>
</body>
</html>
