<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci칩n - SEDIF</title>
    <style>
        :root { --primary: #2c3e50; --accent: #00ad9f; --bg: #f4f7f6; --warning: #e67e22; --danger: #e74c3c; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 20px; margin: 0; }
        .container { max-width: 1000px; margin: 20px auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { color: var(--primary); border-bottom: 2px solid var(--accent); padding-bottom: 10px; margin-top: 0; text-align: center; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 15px; margin-top: 20px; }
        
        /* Estilos de botones */
        .btn { display: block; background: var(--primary); color: white; padding: 15px; border-radius: 12px; text-decoration: none; font-weight: bold; text-align: center; transition: 0.3s; font-size: 0.9em; border: none; cursor: pointer; }
        .btn-main { background: var(--warning); color: white; border: 2px solid #d35400; } 
        .btn-accent { background: var(--accent); }
        .btn-ecala { background: #8e44ad; } 
        
        .btn:hover { opacity: 0.9; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        .section-title { grid-column: 1 / -1; margin-top: 30px; color: #7f8c8d; font-size: 0.85em; text-transform: uppercase; letter-spacing: 1px; font-weight: bold; border-left: 4px solid var(--accent); padding-left: 10px; }
        
        /* Tabla de Monitoreo R치pido */
        .monitor-container { margin-top: 30px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85em; }
        th { background: #f8f9fa; padding: 10px; text-align: left; color: #666; }
        td { padding: 10px; border-bottom: 1px solid #eee; }
        .btn-re { background: var(--warning); color: white; padding: 5px 10px; border-radius: 6px; text-decoration: none; font-size: 0.8em; font-weight: bold; }

        .logout-container { margin-top: 50px; text-align: center; }
        .btn-logout { background: none; border: none; color: var(--danger); cursor: pointer; font-weight: bold; text-decoration: underline; font-size: 1em; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Panel de Control Administrador</h2>
        
        <div class="grid">
            <div class="section-title">Gesti칩n de Tickets y Operaci칩n</div>
            <a href="pendientes.html" class="btn btn-main">游닐 Tickets Pendientes de Asignaci칩n</a>
            <a href="ibreves.html" class="btn btn-ecala">游닇 Nueva Incidencia Express</a>
            <a href="https://docs.google.com/spreadsheets/d/1I1cTeHiKZ3y2AFmNpZoh1QLQQRX-mwv6PQlxpfXD-nA/edit?gid=0#gid=0" target="_blank" class="btn btn-accent">游늵 Base de Datos Completa (Excel)</a>
            
            <div class="section-title">Monitoreo de Tickets Asignados (Reasignaci칩n)</div>
            <div class="monitor-container" style="grid-column: 1 / -1;">
                <p style="font-size: 0.8em; color: #666; margin-bottom: 10px;">* Aqu칤 puedes ver los 칰ltimos tickets y moverlos si el t칠cnico no responde.</p>
                <table>
                    <thead>
                        <tr>
                            <th>Ticket</th>
                            <th>T칠cnico Actual</th>
                            <th>Usuario</th>
                            <th>Acci칩n</th>
                        </tr>
                    </thead>
                    <tbody id="monitor-body">
                        <tr><td colspan="4" style="text-align:center;">Cargando tickets activos...</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="section-title">Historiales Individuales</div>
            <a href="historial.html?nombre=Mtr. Gabriel Terrazas" class="btn">游늶 Gabriel Terrazas</a>
            <a href="historial.html?nombre=Lic. Miguel Chavez" class="btn">游늶 Miguel Chavez</a>
            <a href="historial.html?nombre=Lic. Eduardo Perez" class="btn">游늶 Eduardo Perez</a>
            <a href="historial.html?nombre=Lic. Martin Alejandro Reyes Bocanegra" class="btn">游늶 Alejandro Reyes</a>
            <a href="historial.html?nombre=Fati" class="btn">游늶 Fati</a>
            <a href="historial.html?nombre=Lic. Luis Carlos" class="btn">游늶 Luis Carlos</a>

            <div class="section-title">Equipos: Gabriel, Miguel, Eduardo y Alejandro</div>
            <a href="historial.html?nombre=Mtr. Gabriel - Lic. Eduardo" class="btn">游논 Gabriel - Eduardo</a>
            <a href="historial.html?nombre=Mtr. Gabriel - Lic. Miguel" class="btn">游논 Gabriel - Miguel</a>
            <a href="historial.html?nombre=Lic. Miguel - Lic. Eduardo" class="btn">游논 Miguel - Eduardo</a>
            <a href="historial.html?nombre=Lic. Eduardo - Lic. Alejandro" class="btn">游논 Eduardo - Alejandro</a>
            <a href="historial.html?nombre=Lic. Miguel - Lic. Alejandro" class="btn">游논 Miguel - Alejandro</a>
            <a href="historial.html?nombre=Mtr. Gabriel - Lic. Alejandro" class="btn">游논 Gabriel - Alejandro</a>

            <div class="section-title">Nuevos Equipos con Luis Carlos</div>
            <a href="historial.html?nombre=Lic. Luis Carlos - Lic. Alejandro" class="btn">游논 Luis Carlos - Alejandro</a>
            <a href="historial.html?nombre=Lic. Luis Carlos - Lic. Eduardo" class="btn">游논 Luis Carlos - Eduardo</a>
            <a href="historial.html?nombre=Lic. Luis Carlos - Lic. Miguel" class="btn">游논 Luis Carlos - Miguel</a>
            <a href="historial.html?nombre=Lic. Luis Carlos - Mtr. Gabriel" class="btn">游논 Luis Carlos - Gabriel</a>
        </div>

        <div class="logout-container">
            <button onclick="logout()" class="btn-logout">Cerrar Sesi칩n de Administrador</button>
        </div>
    </div>

    <script>
        // SEGURIDAD
        if(localStorage.getItem('adminSession') !== 'active') {
            window.location.href = "index.html";
        }

        function logout() {
            if(confirm("쮼st치s seguro de que deseas cerrar sesi칩n?")) {
                localStorage.removeItem('adminSession');
                window.location.href = "index.html";
            }
        }

        // FUNCI칍N PARA CARGAR TICKETS RECIENTES Y PERMITIR REASIGNAR
        async function cargarMonitor() {
    const webhookURL = 'https://hook.us2.make.com/g2o6bagpnddob1127nhxqpwc7t6sdadx?nombre=MONITOR'; 
    try {
        console.log("Iniciando carga de monitor...");
        const res = await fetch(webhookURL);
        const data = await res.json();
        
        // Esto nos dir치 en la consola del navegador qu칠 est치 llegando
        console.log("Datos recibidos de Make:", data);

        const body = document.getElementById('monitor-body');
        body.innerHTML = "";

        // Si no hay datos o no es un arreglo
        if (!data || !Array.isArray(data) || data.length === 0) {
            body.innerHTML = "<tr><td colspan='4' style='text-align:center;'>No hay tickets asignados recientemente.</td></tr>";
            return;
        }

        data.slice(0, 8).forEach(t => {
            // Buscamos las variables sin importar si son May칰sculas o Min칰sculas
            const tid = t.id || t.ID || t.Id || 'S/N';
            const tuser = t.usuario || t.Usuario || 'N/A';
            const tprob = t.problema || t.Problema || '';
            const ttec = t.tecnico || t.Tecnico || 'Asignado';

            body.innerHTML += `
                <tr>
                    <td><b>#${tid}</b></td>
                    <td>${ttec}</td>
                    <td>${tuser}</td>
                    <td>
                        <a href="reasignar.html?id=${tid}&nombreActual=${encodeURIComponent(ttec)}&user=${encodeURIComponent(tuser)}&prob=${encodeURIComponent(tprob)}" 
                           class="btn-re" style="background:#e67e22; color:white; padding:5px 10px; border-radius:5px; text-decoration:none; font-size:0.8em;">
                           REASIGNAR
                        </a>
                    </td>
                </tr>`;
        });
    } catch (e) {
        console.error("Error cr칤tico en monitor:", e);
        document.getElementById('monitor-body').innerHTML = "<tr><td colspan='4' style='text-align:center; color:red;'>Error de conexi칩n con Make.</td></tr>";
    }
}
        cargarMonitor();
    </script>
</body>
</html>
