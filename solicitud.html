<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuevo Ticket de Servicio - SEDIF</title>
    <style>
        :root { --primary: #2c3e50; --accent: #00ad9f; --bg: #f4f7f6; --error: #e74c3c; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .card { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); width: 100%; max-width: 600px; }
        h2 { color: var(--primary); text-align: center; border-bottom: 3px solid var(--accent); padding-bottom: 15px; margin-top: 0; }
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: 600; color: #444; margin-bottom: 8px; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1em; box-sizing: border-box; transition: 0.3s; }
        input:focus, select:focus, textarea:focus { border-color: var(--accent); outline: none; box-shadow: 0 0 5px rgba(0, 173, 159, 0.2); }
        .btn-submit { width: 100%; background: var(--primary); color: white; border: none; padding: 15px; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-submit:hover { background: var(--accent); transform: translateY(-2px); }
        .note { font-size: 0.85em; color: #777; margin-top: 5px; }
        input:invalid { border-color: var(--error); }
        #loader { display: none; text-align: center; margin-top: 15px; color: var(--primary); font-weight: bold; }
        #success-msg { display: none; text-align: center; margin-top: 20px; }
        .check-icon { font-size: 50px; color: var(--accent); display: block; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="card" id="form-card">
    <h2>üìù Levantar Ticket de Servicio</h2>
    <p style="text-align:center; color:#666; margin-bottom:30px;">Departamento de Tecnolog√≠as de la Informaci√≥n</p>

    <form id="ticketForm" onsubmit="procesarFormulario(event)">
        
        <div class="form-group">
            <label>Nombre Completo:</label>
            <input type="text" id="nombre" required placeholder="Ej. Juan P√©rez">
        </div>

        <div class="form-group">
            <label>Correo Electr√≥nico:</label>
            <input type="email" id="correo" required placeholder="correo@queretaro.gob.mx">
        </div>

        <div class="form-group">
            <label>Tel√©fono de Contacto:</label>
            <input type="tel" id="telefono" required pattern="[0-9]{10}" maxlength="10" 
                   title="Ingresa solo los 10 n√∫meros, sin espacios ni guiones."
                   placeholder="Ej. 4421234567" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
            <div class="note">Solo 10 d√≠gitos num√©ricos.</div>
        </div>

        <div class="form-group">
            <label>Ubicaci√≥n / Edificio:</label>
            <select id="ubicacion" required>
                <option value="" disabled selected>Selecciona una opci√≥n...</option>
                <option value="ABASTOS">ABASTOS</option>
                <option value="ACTIVOS">ACTIVOS</option>
                <option value="ALBERGUE JUVENTINO CASTRO">ALBERGUE JUVENTINO CASTRO</option>
                <option value="CAI 1">CAI 1</option>
                <option value="CAI 2">CAI 2</option>
                <option value="CAS">CAS</option>
                <option value="CASA DE ECALA">CASA DE ECALA</option>
                <option value="CASA DE LA MUJER">CASA DE LA MUJER</option>
                <option value="CENTRO GERONTOLOGICO SAN JUAN DEL RIO">CENTRO GERONTOLOGICO SAN JUAN DEL RIO</option>
                <option value="CIRR CADEREYTA">CIRR CADEREYTA</option>
                <option value="COPA">COPA</option>
                <option value="CRIQ">CRIQ</option>
                <option value="DESARROLLO COMUNITARIO">DESARROLLO COMUNITARIO</option>
                <option value="JUZGADOS">JUZGADOS</option>
                <option value="LA CRUZ">LA CRUZ</option>
                <option value="MANTENIMIENTO Y CONSERVACION">MANTENIMIENTO Y CONSERVACION</option>
                <option value="NVA REALIDAD">NVA REALIDAD</option>
                <option value="OIC">OIC</option>
                <option value="PLAN VIDA">PLAN VIDA</option>
                <option value="PROCURADURIA ADULTO MAYOR">PROCURADURIA ADULTO MAYOR</option>
                <option value="PROCURADURIA CONSTITUYENTES">PROCURADURIA CONSTITUYENTES</option>
                <option value="TRANSPORTES">TRANSPORTES</option>
                <option value="Otro">Otro</option>
            </select>
        </div>

        <div class="form-group">
            <label>Departamento / Direcci√≥n:</label>
            <input type="text" id="departamento" required placeholder="Ej. Recursos Humanos">
        </div>

        <div class="form-group">
            <label>Descripci√≥n del Problema:</label>
            <textarea id="problema" rows="4" required placeholder="Describe brevemente en qu√© necesitas ayuda..."></textarea>
        </div>

        <div class="form-group">
            <label>Adjuntar Evidencia (Opcional):</label>
            <input type="file" id="evidencia" accept="image/*,.pdf">
            <div class="note">Foto o PDF (M√°x 5MB)</div>
        </div>

        <button type="submit" class="btn-submit">üöÄ Generar Ticket</button>
        <div id="loader">Subiendo ticket y archivos... esto puede tardar unos segundos ‚è≥</div>
    </form>
</div>

<div class="card" id="success-msg">
    <div class="check-icon">‚úî</div>
    <h2 style="border:none;">¬°Ticket Creado!</h2>
    <p>Hemos recibido tu solicitud y evidencias.</p>
    <button onclick="location.reload()" class="btn-submit" style="margin-top:20px; background:#eee; color:#333;">Levantar otro ticket</button>
</div>

<script>
    // üëáüëáüëá AQU√ç PEGA TU URL DE APPS SCRIPT üëáüëáüëá
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxZhLFw530NGYRXyvdJLoMw0Y40VijyHqW0dwnkEv6Id68GiB__W77WEPYoaliusost/exec'; 

    async function procesarFormulario(e) {
        e.preventDefault();
        
        const btn = document.querySelector('.btn-submit');
        const loader = document.getElementById('loader');
        btn.style.display = 'none';
        loader.style.display = 'block';

        const data = {
            accion: "crear_ticket",
            nombre: document.getElementById('nombre').value,
            correo: document.getElementById('correo').value,
            telefono: document.getElementById('telefono').value,
            ubicacion: document.getElementById('ubicacion').value,
            departamento: document.getElementById('departamento').value,
            problema: document.getElementById('problema').value,
            archivo: null,
            nombreArchivo: null,
            mimeType: null
        };

        const fileInput = document.getElementById('evidencia');
        if (fileInput.files.length > 0) {
            const file = fileInput.files[0];
            if (file.size > 5 * 1024 * 1024) {
                alert("El archivo es demasiado grande. M√°ximo 5MB.");
                btn.style.display = 'block';
                loader.style.display = 'none';
                return;
            }
            try {
                const base64 = await toBase64(file);
                data.archivo = base64.split(',')[1]; 
                data.nombreArchivo = file.name;
                data.mimeType = file.type;
            } catch (err) {
                console.error("Error archivo", err);
                alert("Error al leer el archivo.");
                return;
            }
        }

        enviarDatos(data);
    }

    const toBase64 = file => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });

    async function enviarDatos(data) {
        try {
            await fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            document.getElementById('form-card').style.display = 'none';
            document.getElementById('success-msg').style.display = 'block';

        } catch (error) {
            console.error('Error!', error);
            alert('Error de conexi√≥n.');
            document.querySelector('.btn-submit').style.display = 'block';
            document.getElementById('loader').style.display = 'none';
        }
    }
</script>

</body>
</html>
